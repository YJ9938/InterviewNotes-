电路交换：专用物理线路，通信过程始终占据，利用率低

分组交换：分组有首部和尾部，包含源 目的地址，同线路允许同时传输多个分组

- 存储转发：收到数据先存储，将相同目的地的一起转发到下一个目的地



## 计算机网络体系

![网络01](D:\02实习\02Notes\1准备暑期实习\笔记图片\网络01.png)

应用层：为**特定应用程序**提供数据传输服务，例如 HTTP、DNS 等协议

传输层：为**进程**提供通用数据传输服务；由于应用层协议很多，定义通用的传输层协议就可以支持不断增多的应用层协议

- 传输控制协议 TCP，提供面向连接、可靠的数据传输服务，数据单位为**报文段**
- 用户数据报协议 UDP，提供无连接、尽最大努力的数据传输服务，数据单位为用户**数据报**

网络层：为**主机**提供数据传输服务。而传输层协议是为主机中的进程提供数据传输服务

数据链路层：为**同一链路的主机**提供数据传输服务

物理层：在传输媒体上传输数据比特流



五层协议没有表示层和会话层，而是将这些功能留给应用程序开发者处理

表示层：数据压缩、加密以及数据描述，这使得应用程序不必关心在各台主机中数据内部格式不同的问题

会话层：建立及管理会话



数据在各层之间传输：在向下的过程中，需要添加下层协议所需要的首部或者尾部；在向上的过程中不断拆开首部和尾部



## 网络层

地址解析协议ARP：实现由 IP 地址得到 MAC 地址

网际控制报文协议ICMP：为了更有效地转发 IP 数据报和提高交付成功的机会，**它封装在 IP 数据报中**，但是不属于高层协议；ICMP 报文分为差错报告报文和询问报文

- Ping 是 ICMP 的一个重要应用，主要用来测试两台主机之间的连通性
- Traceroute 是 ICMP 的另一个应用，用来跟踪一个分组从源点到终点的路径

网络地址转换NAT ：本地 IP 转换为全球 IP，现在常用的 NAT 转换表把传输层的端口号也用上了，使得多个专用网内部的主机共用一个全球 IP 地址

用于解决内网中的主机要和因特网上的主机通信。由NAT路由器将主机的本地IP地址转换为全球IP 地址，分为静态转换（转换得到的全球IP地址固定不变）和动态NAT转换



路由器

- 功能上可以划分为：路由选择和分组转发

- 路由选择协议

  内部网关协议：RIP基于距离向量的路由选择协议；OSPF开放最短路径优先 

  外部网关协议：BGP边界网关协议



## 传输层

真正通信的是主机中的**进程**，传输层提供了进程间的逻辑通信

用户数据报协议 UDP：是无连接的，尽最大可能交付，没有拥塞控制，**面向报文（对于应用程序传下来的报文不合并也不拆分，只是添加 UDP 首部）**，支持一对一、一对多、多对一和多对多的交互通信

传输控制协议 TCP：是面向连接的，提供可靠交付，有流量控制，拥塞控制，提供全双工通信，**面向字节流（把应用层传下来的报文看成字节流，把字节流组织成大小不等的数据块）**，每一条 TCP 连接只能是**点对点的（一对一）**

- **确认号** ：期望收到的下一个报文段的序号

- **确认 ACK** ：当 ACK=1 时确认号字段有效，否则无效。TCP 规定，在连接建立后所有传送的报文段都必须把 ACK 置 1（ACK 在连接建立之后都为 1）
- **同步 SYN** ：在连接建立时用来同步序号。当 SYN=1，ACK=0 时表示这是一个连接请求报文段。若对方同意建立连接，则响应报文中 SYN=1，ACK=1



### **TCP UDP区别**

`TCP`  面向连接 可靠 稳定 ；在传递数据之前通过三次握手建立连接，在传输数据时 有确认、窗口、重传、拥塞控制 ；但缺点是 速度慢，占用系统资源较高

`UDP` 传输速度快，面向非连接，传输不可靠，传输时如果网络质量不好 容易丢包

当对网络通讯质量有要求的时候 使用 `TCP`

当对网络通讯质量要求不高的时候，要求网络通讯速度能尽量的快，这时就可以使用`UDP`



### TCP三次握手

![网络02](D:\02实习\02Notes\1准备暑期实习\笔记图片\网络02.png)

假设 A 为客户端，B 为服务器端。

- 首先 B 处于 LISTEN（监听）状态，等待客户的连接请求。
- A 向 B 发送连接请求报文，SYN=1，ACK=0，选择一个初始的序号 x。
- B 收到连接请求报文，如果同意建立连接，则向 A 发送连接确认报文，SYN=1，ACK=1，确认号为 x+1，同时也选择一个初始的序号 y。
- A 收到 B 的连接确认报文后，**还要向 B 发出确认**，ACK=1 确认号为 y+1，序号为 x+1(ACK 在连接建立之后都为 1)
- B 收到 A 的确认后，连接建立



**三次握手原因** 第三次握手是为了防止失效的连接请求到达服务器，让服务器错误打开连接



### TCP四次挥手

![网络03](D:\02实习\02Notes\1准备暑期实习\笔记图片\网络03.png)

以下描述不讨论序号和确认号，因为序号和确认号的规则比较简单。并且不讨论 ACK，**因为 ACK 在连接建立之后都为 1**。

- A 发送连接释放报文，FIN=1。
- B 收到之后发出确认，此时 TCP 属于半关闭状态，B 能向 A 发送数据但是 A 不能向 B 发送数据。
- 当 B 不再需要连接时，发送连接释放报文，FIN=1。
- A 收到后发出确认，进入 TIME-WAIT 状态，等待 2 MSL（最大报文存活时间）后释放连接。
- B 收到 A 的确认后释放连接

**TIME_WAIT**

- 确保最后一个确认报文能够到达。如果 B 没收到 A 发送来的确认报文，那么就会重新发送连接释放请求报文，A 等待一段时间就是为了处理这种情况的发生。
- 等待一段时间是为了让本连接持续时间内所产生的所有报文都从网络中消失，使得下一个新的连接不会出现旧的连接请求报文



**TCP可靠传输**：使用超时重传来实现可靠传输：如果一个已经发送的报文段在超时时间内没有收到确认，那么就重传这个报文段

**TCP流量控制**：流量控制是为了控制发送方发送速率，保证接收方来得及接收；确认报文中的窗口字段可以用来控制发送方窗口大小

**TCP拥塞控制** 慢开始、拥塞避免、快重传、快恢复

- 慢开始 拥塞避免

  拥塞窗口cwnd = 1，发送方只能发送 1 个报文段；当收到确认后，将 cwnd 加倍，因此之后发送方能够发送的报文段数量为：2、4、8 

  设置一个慢开始门限 ssthresh，当 cwnd >= ssthresh 时，进入拥塞避免，每个轮次只将 cwnd 加 1

  **如果出现了超时**，则令 ssthresh = cwnd / 2，然后重新执行慢开始

- 快重传 快恢复

  在发送方，如果收到三个重复确认，那么可以知道下一个报文段丢失，此时执行快重传，立即重传下一个报文段，在这种情况下，只是丢失个别报文段，而不是网络拥塞。**因此执行快恢复**，令 ssthresh = cwnd / 2 ，cwnd = ssthresh，注意到此时直接进入拥塞避免

  ![网络04](D:\02实习\02Notes\1准备暑期实习\笔记图片\网络04.png)

**慢开始和快恢复的快慢指的是 cwnd 的设定值，而不是 cwnd 的增长速率。慢开始 cwnd 设定为 1，而快恢复 cwnd 设定为 ssthresh**



## 应用层

**域名系统** DNS 是一个分布式数据库，提供了**主机名和 IP 地址之间相互转换的服务**

DNS 可以使用 UDP 或者 TCP 进行传输，使用的端口号都为 53。大多数情况下 DNS 使用 UDP 进行传输

在两种情况下会使用 TCP 进行传输：

- 如果返回的响应超过的 512 字节（UDP 最大只支持 512 字节的数据）。
- 区域传送（区域传送是主域名服务器向辅助域名服务器传送变化的那部分数据）



**文件传输协议 FTP**

FTP 使用 TCP 进行连接，它需要两个连接来传送一个文件

- 控制连接：服务器打开端口号 21 等待客户端的连接，客户端主动建立连接后，使用这个连接将客户端的命令传送给服务器，并传回服务器的应答。

- 数据连接：用来传送一个文件数据

  根据数据连接是否是服务器端主动建立，FTP 有主动和被动两种模式

  主动模式：服务器端主动建立数据连接，其中服务器端的端口号为 20，客户端的端口号随机

  被动模式：客户端主动建立数据连接，其中客户端的端口号由客户端自己指定，服务器端的端口号随机



**动态主机配置协议DHCP**

用户不再需要手动配置 IP 地址等信息.



**远程登录协议Telnet**

**电子邮件协议** SMTP POP3 IMAP



![网络05](D:\02实习\02Notes\1准备暑期实习\笔记图片\网络05.png)





# `http和https`区别

HTTP协议以明文方式发送内容，不提供任何方式的数据加密

https则是具有安全性加密传输协议

http和https使用的是完全不同的连接方式，用的端口也不一样，前者是80，后者是443

http的连接很简单，是无状态的；HTTPS协议是由SSL（安全套接字协议）+HTTP协议构建的可进行加密传输、身份认证，比http协议安全



## 浏览器输入`url`并回车以后都发生了什么

1.浏览器解析 URL（统一资源定位符）， URL主要包括 传输协议、服务器、域名、端口、虚拟目录、文件名等；

2.然后，`DNS`解析（域名解析），依次检查 浏览器缓存、操作系统缓存、路由器缓存、 `ISP DNS`缓存、根域名服务器缓存；`DNS`服务器查询分为 递归查询 和 迭代查询

3.浏览器与网站建立 `TCP`连接（三次握手）

4.之后进行请求和传输数据

5.接收到数据后浏览器渲染界面







## Web页面请求过程

1.**浏览器查询 DNS**，获取域名对应的IP地址:具体过程包括浏览器搜索自身的DNS缓存、搜索操作系 统的DNS缓存、读取本地的Host文件和向**本地DNS服务器**进行查询等。对于向本地DNS服务器进 行查询，如果要查询的域名包含在本地配置区域资源中，则返回解析结果给客户机，完成域名解析 (此解析具有权威性)；如果要查询的域名不由本地DNS服务器区域解析，但该服务器已缓存了此网 址映射关系，则调用这个IP地址映射，完成域名解析（此解析不具有权威性）。如果本地域名服务 器并未缓存该网址映射关系，那么将**根据其设置发起递归查询或者迭代查询**；

2.浏览器获得域名对应的IP地址以后，浏览器向服务器请求建立链接，发起三次握手； 

3.TCP/IP链接建立起来后，浏览器向服务器发送HTTP请求； 

4.服务器接收到这个请求，并根据路径参数映射到特定的请求处理器进行处理，并将处理结果及相应 的视图返回给浏览器； 

5.浏览器解析并渲染视图，若遇到对js文件、css文件及图片等**静态资源的引用**，则**重复上述步骤**并 向服务器请求这些资源； 

6.浏览器根据其请求到的资源、数据**渲染页面**，最终向用户呈现一个完整的页面。





**1.配置主机信息**

假设主机最开始没有 IP 地址以及其它信息，那么就需要先使用 DHCP 来获取

主机生成一个 DHCP 请求报文，并将这个报文放入具有目的端口 67 和源端口 68 的 UDP 报文段中

该报文段则被放入在一个具有广播 IP 目的地址(255.255.255.255) 和源 IP 地址（0.0.0.0）的 IP 数据报中

DHCP 服务器收到广播帧之后，生成 DHCP ACK 报文，该报文包含以下信息：IP 地址、DNS 服务器的 IP 地址、默认网关路由器的 IP 地址和子网掩码

主机收到该帧后，不断分解得到 DHCP 报文。之后就配置它的 IP 地址、子网掩码和 DNS 服务器的 IP 地址，并在其 IP 转发表中安装默认网关

**2.ARP解析MAC地址**

主机通过浏览器生成一个 TCP 套接字，套接字向 HTTP 服务器发送 HTTP 请求。为了生成该套接字，主机需要知道网站的域名对应的 IP 地址

主机生成一个 DNS 查询报文，该报文具有 53 号端口，因为 DNS 服务器的端口号是 53

为了获取网关路由器的 MAC 地址，需要使用 ARP 协议（IP得到MAC

**3.DNS解析域名**

到达 DNS 服务器之后，DNS 服务器抽取出 DNS 查询报文，并在 DNS 数据库中查找待解析的域名

**4.HTTP请求页面**

有了 HTTP 服务器的 IP 地址之后，主机就能够生成 TCP 套接字，该套接字将用于向 Web 服务器发送 HTTP GET 报文

在生成 TCP 套接字之前，必须先与 HTTP 服务器进行**三次握手来建立连接**

连接建立之后，浏览器生成 HTTP GET 报文，并交付给 HTTP 服务器

生成一个 HTTP 响应报文，将 Web 页面内容放入报文主体中，发回给主机

浏览器收到 HTTP 响应报文后，抽取出 Web 页面内容，之后进行渲染，显示 Web 页面

